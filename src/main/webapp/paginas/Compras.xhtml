<ui:composition
        xmlns:ui="jakarta.faces.facelets"
        xmlns:f="jakarta.faces.core"
        xmlns:h="jakarta.faces.html"
        xmlns:p="http://primefaces.org/ui"
        xmlns:ues="jakarta.faces.composite/ues"
        xmlns="http://www.w3.org/1999/xhtml"
        template="../WEB-INF/plantilla/default.xhtml">

    <ui:define name="header">
        <h1>#{defaultfrm['page.compra']}</h1>
    </ui:define>

    <ui:define name="contenido-tabla">
        <h:panelGrid>
            <h:form id="frmTop">
                <p:dataTable lazy="true"
                             rendered="#{compraFrm.estado == 'NADA'}"
                             rows="#{compraFrm.pageSize}"
                             paginator="true"
                             paginatorPosition="bottom"
                             value="#{compraFrm.listaCompras}" var="reg"
                             selectionMode="single"
                             selection="#{compraFrm.registro}"
                             styleClass="tabla-crud"
                             rowKey="#{reg.id}"
                >

                    <p:ajax event="rowSelect"
                            listener="#{compraFrm.seleccionarRegistro}"
                            update=":pnlDetalle :pnlTabla"/>

                    <p:column headerText="ID">
                        <h:outputText value="#{reg.id}"/>
                    </p:column>

                    <p:column headerText="Proveedor">
                        <h:outputText value="#{reg.idProveedor != null ? reg.idProveedor.nombre : '-'}"/>
                    </p:column>

                    <p:column headerText="Fecha">
                        <h:outputText value="#{reg.fecha}">
                            <f:convertDateTime type="offsetDateTime" pattern="dd/MM/yyyy HH:mm:ss" />
                        </h:outputText>
                    </p:column>

                    <p:column headerText="Estado">
                        <h:outputText value="#{reg.estado}"/>
                    </p:column>

                    <p:column headerText="Observaciones">
                        <h:outputText value="#{reg.observaciones}"/>
                    </p:column>

                </p:dataTable>

                <ues:botones-top formulario="#{compraFrm}" actualizar=":pnlDetalle :pnlTabla"/>
            </h:form>
        </h:panelGrid>
    </ui:define>


    <ui:define name="contenido-detalle">
        <p:tabView id="tabCompra" cache="false" dynamic="true" rendered="#{compraFrm.estado != 'NADA'}">
            <p:tab closable="false" title="Generalidades">

                <h:panelGroup id="pnlProveedor">
                    <h:form id="frmCrear">
                        <h:panelGrid columns="2">

                            <p:outputLabel for="txtId" value="ID:"/>
                            <p:inputText id="txtId"
                                         value="#{compraFrm.registro.id}"
                                         readonly="true" disabled="true"/>

                            <p:outputLabel for="cmbProveedor" value="Proveedor:"/>
                            <p:selectOneMenu id="cmbProveedor"
                                             value="#{compraFrm.registro.idProveedor.nombre}"
                                             required="true"
                                             requiredMessage="Debe seleccionar un proveedor."
                                             converter="proveedorConverter">
                                <f:selectItem itemLabel="Seleccione" itemValue="#{null}" noSelectionOption="true"/>
                                <f:selectItems value="#{proveedorFrm.listaProveedores}"
                                               var="p"
                                               itemLabel="#{p.nombre}"
                                               itemValue="#{p}"/>
                            </p:selectOneMenu>

                            <p:outputLabel for="dpFecha" value="Fecha de compra:"/>
                            <p:datePicker id="dpFecha"
                                          value="#{compraFrm.registro.fecha}"
                                          showTime="true"
                                          hourFormat="24"
                                          timeInput="true"
                                          timeZone="America/El_Salvador"
                                          pattern="yyyy-MM-dd'T'HH:mm"
                                          converter="offsetDateTimeConverter"
                                          required="true"
                                          requiredMessage="La fecha es obligatoria"/>

                            <p:outputLabel for="cmbEstado" value="Estado:"/>
                            <p:selectOneMenu id="cmbEstado"
                                             value="#{compraFrm.registro.estado}"
                                             required="true"
                                             requiredMessage="Debe seleccionar un estado.">
                                <f:selectItem itemLabel="Seleccione" itemValue="#{null}" noSelectionOption="true"/>
                                <f:selectItem itemLabel="ACTIVA" itemValue="ACTIVA"/>
                                <f:selectItem itemLabel="ANULADA" itemValue="ANULADA"/>
                                <f:selectItem itemLabel="FINALIZADA" itemValue="FINALIZADA"/>
                            </p:selectOneMenu>

                            <p:outputLabel for="txtObservaciones" value="Observaciones:"/>
                            <p:inputTextarea id="txtObservaciones"
                                             value="#{compraFrm.registro.observaciones}"
                                             rows="4" cols="50"/>

                        </h:panelGrid>

                        <ues:botones-crud formulario="#{compraFrm}" actualizar=":pnlDetalle :pnlTabla"/>
                    </h:form>
                </h:panelGroup>

            </p:tab>
        </p:tabView>
    </ui:define>

</ui:composition>
